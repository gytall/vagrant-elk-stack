# –û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤—ã–π –≤–µ–±-—Å–µ—Ä–≤–∏—Å —Å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º –∏ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–º —Å–±–æ—Ä–æ–º –ª–æ–≥–æ–≤

  

## üìå –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

  

–î–∞–Ω–Ω—ã–π –ø—Ä–æ–µ–∫—Ç —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ø–æ–ª–Ω—É—é –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–ª—è –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ–≥–æ –≤–µ–±-—Å–µ—Ä–≤–∏—Å–∞ —Å –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏, –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º –∏ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–º —Å–±–æ—Ä–æ–º –ª–æ–≥–æ–≤. –ü—Ä–æ–µ–∫—Ç —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç—Å—è –Ω–∞ –¥–≤—É—Ö –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –º–∞—à–∏–Ω–∞—Ö —Å –ø–æ–º–æ—â—å—é **Vagrant** –∏ **VirtualBox**.

  

### –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π —Å—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π:

  

- **–í–µ–±-—Å–µ—Ä–≤–µ—Ä —Å –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–æ–π**: Nginx (frontend) + Apache (backend)

- **–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è**: Docker, Docker Compose

- **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã**: Prometheus + Grafana

- **–≠–∫—Å–ø–æ—Ä—Ç–µ—Ä—ã –º–µ—Ç—Ä–∏–∫**: node_exporter, nginx-prometheus-exporter, apache_exporter

- **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π —Å–±–æ—Ä –ª–æ–≥–æ–≤**: ELK Stack (Elasticsearch, Logstash, Kibana) + Filebeat

  

---

  

## üß± –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

  

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **2 –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –º–∞—à–∏–Ω—ã** –Ω–∞ –±–∞–∑–µ **Ubuntu 22.04 LTS (jammy)**:

  

| –í–ú             | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ              | IP            | RAM  | CPU | –ü–æ—Ä—Ç—ã                           |
| -------------- | ----------------------- | ------------- | ---- | --- | ------------------------------- |
| **web**        | –í–µ–±-—Å–µ—Ä–≤–µ—Ä + —ç–∫—Å–ø–æ—Ä—Ç–µ—Ä—ã | 192.168.56.10 | 4 GB | 2   | 80, 8081-8083, 9100, 9113, 9117 |
| **monitoring** | –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ + ELK        | 192.168.56.20 | 8 GB | 2   | 3000, 5044, 5601, 9090, 9200    |

  

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –Ω–∞ VM1 (web):

  

- **Nginx** (–ø–æ—Ä—Ç 80) - –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫ –Ω–∞–≥—Ä—É–∑–∫–∏

- **Apache** (–ø–æ—Ä—Ç—ã 8081, 8082, 8083) - —Ç—Ä–∏ backend-—Å–µ—Ä–≤–µ—Ä–∞

- **node_exporter** (–ø–æ—Ä—Ç 9100) - —Å–∏—Å—Ç–µ–º–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏

- **nginx-prometheus-exporter** (–ø–æ—Ä—Ç 9113) - –º–µ—Ç—Ä–∏–∫–∏ Nginx

- **apache_exporter** (–ø–æ—Ä—Ç 9117) - –º–µ—Ç—Ä–∏–∫–∏ Apache

- **Filebeat** (Docker) - —Å–±–æ—Ä –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ –ª–æ–≥–æ–≤ –≤ ELK

  

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –Ω–∞ VM2 (monitoring):

  

- **Prometheus** (–ø–æ—Ä—Ç 9090) - —Å–±–æ—Ä –∏ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫

- **Grafana** (–ø–æ—Ä—Ç 3000) - –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –º–µ—Ç—Ä–∏–∫

- **Elasticsearch** (–ø–æ—Ä—Ç 9200) - —Ö—Ä–∞–Ω–µ–Ω–∏–µ –ª–æ–≥–æ–≤

- **Logstash** (–ø–æ—Ä—Ç 5044) - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ª–æ–≥–æ–≤

- **Kibana** (–ø–æ—Ä—Ç 5601) - –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –ª–æ–≥–æ–≤

  

---

  

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

  

```

.

‚îú‚îÄ‚îÄ Vagrantfile # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –º–∞—à–∏–Ω

‚îú‚îÄ‚îÄ README.md # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞

‚îî‚îÄ‚îÄ provision/

  ‚îú‚îÄ‚îÄ common.sh # –û–±—â–∞—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –í–ú (Docker, —É—Ç–∏–ª–∏—Ç—ã)

  ‚îú‚îÄ‚îÄ web.sh # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞ –∏ —ç–∫—Å–ø–æ—Ä—Ç–µ—Ä–æ–≤

  ‚îú‚îÄ‚îÄ monitoring.sh # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ ELK

  ‚îî‚îÄ‚îÄ configs/

    ‚îú‚îÄ‚îÄ nginx.conf # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Nginx (–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫ + JSON –ª–æ–≥–∏)

      ‚îú‚îÄ‚îÄ apache-backend.conf # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Apache (3 –ø–æ—Ä—Ç–∞ + mod_status)

      ‚îú‚îÄ‚îÄ prometheus.yml # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Prometheus (targets)

      ‚îú‚îÄ‚îÄ elk-docker-compose.yml # Docker Compose –¥–ª—è ELK Stack

      ‚îú‚îÄ‚îÄ logstash.conf # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Logstash (–æ–±—Ä–∞–±–æ—Ç–∫–∞ –ª–æ–≥–æ–≤)

      ‚îú‚îÄ‚îÄ filebeat.yml # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Filebeat (—Å–±–æ—Ä –ª–æ–≥–æ–≤)

      ‚îî‚îÄ‚îÄ filebeat-docker-compose.yml # Docker Compose –¥–ª—è Filebeat

```

  

---

  

## ‚öôÔ∏è –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

  

–ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ:

  

- **Vagrant** ‚â• 2.x

- **VirtualBox** ‚â• 6.x

- **–î–æ—Å—Ç—É–ø –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç** (–¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –ø–∞–∫–µ—Ç–æ–≤ –∏ Docker-–æ–±—Ä–∞–∑–æ–≤)

- –ú–∏–Ω–∏–º—É–º **12 GB —Å–≤–æ–±–æ–¥–Ω–æ–π RAM** (4 GB –¥–ª—è web + 8 GB –¥–ª—è monitoring)

- –ú–∏–Ω–∏–º—É–º **40 GB —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞** –Ω–∞ –¥–∏—Å–∫–µ

  

---

  

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

  

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø–µ—Ä–µ—Ö–æ–¥ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é

  

```bash

cd /path/to/direcory/vagrant-elk-stack

```

  

### 2. –ó–∞–ø—É—Å–∫ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –º–∞—à–∏–Ω

  

```bash

vagrant up

```

  

–ü—Ä–æ—Ü–µ—Å—Å –∑–∞–π–º—ë—Ç **10-15 –º–∏–Ω—É—Ç**:

- –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –æ–±—Ä–∞–∑–∞ Ubuntu

- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–∞–∫–µ—Ç–æ–≤

- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤

- –ó–∞–ø—É—Å–∫ Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤

  

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞

  

```bash

vagrant status

```

  

–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:

```

web running (virtualbox)

monitoring running (virtualbox)

```

  

---

  

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã —Å–µ—Ä–≤–∏—Å–æ–≤

  

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏ –Ω–∞–≥—Ä—É–∑–∫–∏

  

```bash

vagrant ssh web

curl http://localhost

```

  

–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ - –¥–æ–ª–∂–Ω—ã –ø–æ–æ—á–µ—Ä–µ–¥–Ω–æ –ø–æ—è–≤–ª—è—Ç—å—Å—è:

- `Server 1`

- `Server 2`

- `Server 3`

  

–≠—Ç–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç, —á—Ç–æ Nginx –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –º–µ–∂–¥—É —Ç—Ä–µ–º—è Apache-—Å–µ—Ä–≤–µ—Ä–∞–º–∏.

  

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–µ—Ä–æ–≤ –º–µ—Ç—Ä–∏–∫

  

–ù–∞ VM **web**:

  

```bash

# Node Exporter (—Å–∏—Å—Ç–µ–º–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏)

curl http://localhost:9100/metrics | head -20

  

# Nginx Exporter

curl http://localhost:9113/metrics | head -20

  

# Apache Exporter

curl http://localhost:9117/metrics | head -20

```

  

### –ü—Ä–æ–≤–µ—Ä–∫–∞ Prometheus

  

–û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ: http://192.168.56.20:9090

  

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Status ‚Üí Targets**

2. –í—Å–µ targets –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ **UP**:

- `prometheus` (localhost:9090)

- `node` (192.168.56.10:9100)

- `nginx` (192.168.56.10:9113)

- `apache` (192.168.56.10:9117)

  

3. –í –≥—Ä–∞—Ñ–µ –ø–æ–∏—Å–∫–∞ –≤–≤–µ–¥–∏—Ç–µ –º–µ—Ç—Ä–∏–∫—É `up` - –∑–Ω–∞—á–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å `1` –¥–ª—è –≤—Å–µ—Ö —ç–∫—Å–ø–æ—Ä—Ç–µ—Ä–æ–≤

  

### –ü—Ä–æ–≤–µ—Ä–∫–∞ Grafana

  

–û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ: http://192.168.56.20:3000

  

**–õ–æ–≥–∏–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:**

- Username: `admin`

- Password: `admin`

  

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –¥–∞–Ω–Ω—ã—Ö:**

  

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Configuration ‚Üí Data Sources**

2. –ù–∞–∂–º–∏—Ç–µ **Add data source**

3. –í—ã–±–µ—Ä–∏—Ç–µ **Prometheus**

4. URL: `http://localhost:9090`

5. –ù–∞–∂–º–∏—Ç–µ **Save & Test**

  

**–ò–º–ø–æ—Ä—Ç –≥–æ—Ç–æ–≤—ã—Ö –¥–∞—à–±–æ—Ä–¥–æ–≤:**

  

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Dashboards ‚Üí Import**

2. –ò–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –¥–∞—à–±–æ—Ä–¥—ã:

- **Node Exporter Full**: ID `XXX`

- **NGINX Prometheus Exporter**: ID `XXX`

- **Apache Dashboard**: ID `XXX`

  

### –ü—Ä–æ–≤–µ—Ä–∫–∞ ELK Stack

  

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤:**

  

```bash

vagrant ssh monitoring

docker ps

```

  

–î–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω—ã:

- `elasticsearch`

- `logstash`

- `kibana`

  

**–ü—Ä–æ–≤–µ—Ä–∫–∞ Elasticsearch:**

  

```bash

curl http://localhost:9200

```

  

**–ü—Ä–æ–≤–µ—Ä–∫–∞ Kibana:**

  

–û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ: http://192.168.56.20:5601

  

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Stack Management ‚Üí Index Patterns**

2. –°–æ–∑–¥–∞–π—Ç–µ index pattern: `nginx-logs-*`

3. –í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª–µ –≤—Ä–µ–º–µ–Ω–∏: `@timestamp` –∏–ª–∏ `time_local`

4. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Discover** –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ª–æ–≥–æ–≤

  

**–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Ç—Ä–∞—Ñ–∏–∫–∞:**

  

```bash

vagrant ssh web

# –°–æ–∑–¥–∞—ë–º –Ω–∞–≥—Ä—É–∑–∫—É –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ª–æ–≥–æ–≤

for i in {1..50}; do curl -s http://localhost > /dev/null; done

```

  

–õ–æ–≥–∏ –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è –≤ Kibana —á–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥.

  

### –ü—Ä–æ–≤–µ—Ä–∫–∞ Filebeat

  

```bash

vagrant ssh web

docker ps | grep filebeat

docker logs filebeat

```

  

---

  

## üîê –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ø–æ SSH

  

```bash

# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä—É

vagrant ssh web

  

# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

vagrant ssh monitoring

```

  

---

  

## üîÑ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–º–∏ –º–∞—à–∏–Ω–∞–º–∏

  

### –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ provisioning (–ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å–∫—Ä–∏–ø—Ç–æ–≤)

  

```bash

# –î–ª—è –≤—Å–µ—Ö –í–ú

vagrant provision

  

# –î–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –í–ú

vagrant provision web

vagrant provision monitoring

```

  

### –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –í–ú

  

```bash

vagrant reload

```

  

### –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –í–ú

  

```bash

vagrant halt

```

  

### –ü–æ–ª–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –∏ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–µ

  

```bash

vagrant destroy -f

vagrant up

```

  

‚ö†Ô∏è **–í–Ω–∏–º–∞–Ω–∏–µ:** –í—Å–µ –¥–∞–Ω–Ω—ã–µ –≤–Ω—É—Ç—Ä–∏ –í–ú –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã!

  

---

  

## üìä –î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

  

### 1. –í–µ–±-—Å–µ—Ä–≤–µ—Ä (Nginx + Apache)

  

**Nginx** –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∫–∞–∫ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ –ø–æ—Ä—Ç—É **80**:

- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `upstream` —Å —Ç—Ä–µ–º—è backend-—Å–µ—Ä–≤–µ—Ä–∞–º–∏

- –†–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –ø–æ –∞–ª–≥–æ—Ä–∏—Ç–º—É round-robin

- –ù–∞—Å—Ç—Ä–æ–µ–Ω JSON-—Ñ–æ—Ä–º–∞—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è ELK

- –í–∫–ª—é—á—ë–Ω `stub_status` –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ (endpoint `/stub_status`)

  

**Apache** —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ —Ç—Ä—ë—Ö –ø–æ—Ä—Ç–∞—Ö:

- **8081** - Server 1 (`/var/www/html1`)

- **8082** - Server 2 (`/var/www/html2`)

- **8083** - Server 3 (`/var/www/html3`)

  

–ö–∞–∂–¥—ã–π —Å–µ—Ä–≤–µ—Ä –∏–º–µ–µ—Ç —Ç–µ—Å—Ç–æ–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º –Ω–æ–º–µ—Ä–æ–º.


  

### 2. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (Prometheus + Grafana)

  

**Prometheus** —Å–æ–±–∏—Ä–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ –∫–∞–∂–¥—ã–µ **15 —Å–µ–∫—É–Ω–¥** –æ—Ç:

- `node_exporter` - CPU, –ø–∞–º—è—Ç—å, –¥–∏—Å–∫, —Å–µ—Ç—å

- `nginx-prometheus-exporter` - –∑–∞–ø—Ä–æ—Å—ã, —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è, —Å—Ç–∞—Ç—É—Å—ã Nginx

- `apache_exporter` - –∑–∞–ø—Ä–æ—Å—ã, workers, —Å—Ç–∞—Ç—É—Å—ã Apache

  

**Grafana** –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é –º–µ—Ç—Ä–∏–∫ —á–µ—Ä–µ–∑ –≥–æ—Ç–æ–≤—ã–µ –¥–∞—à–±–æ—Ä–¥—ã.

  

### 3. –°–±–æ—Ä –ª–æ–≥–æ–≤ (ELK + Filebeat)

  

**Filebeat** (Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–∞ web-—Å–µ—Ä–≤–µ—Ä–µ):

- –°–æ–±–∏—Ä–∞–µ—Ç –ª–æ–≥–∏ –∏–∑ `/var/log/nginx/access.log`

- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ Logstash –Ω–∞ –ø–æ—Ä—Ç **5044**

  

**Logstash**:

- –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –ª–æ–≥–∏ –æ—Ç Filebeat

- –ü–∞—Ä—Å–∏—Ç JSON-—Ñ–æ—Ä–º–∞—Ç

- –ò–Ω–¥–µ–∫—Å–∏—Ä—É–µ—Ç –≤ Elasticsearch

  

**Elasticsearch**:

- –•—Ä–∞–Ω–∏—Ç –ª–æ–≥–∏ –≤ –∏–Ω–¥–µ–∫—Å–∞—Ö —Ñ–æ—Ä–º–∞—Ç–∞ `nginx-logs-YYYY.MM.DD`

- –û—Ç–∫–ª—é—á–µ–Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (`xpack.security.enabled=false`) –¥–ª—è —É–ø—Ä–æ—â–µ–Ω–∏—è

  

**Kibana**:

- –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –ª–æ–≥–æ–≤

- –ü–æ–∏—Å–∫ –∏ –∞–Ω–∞–ª–∏–∑

- –°–æ–∑–¥–∞–Ω–∏–µ –¥–∞—à–±–æ—Ä–¥–æ–≤

  

---



## üìù –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

  

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ —Å–µ—Ä–≤–∏—Å–æ–≤

  

```bash

# –õ–æ–≥–∏ Nginx

vagrant ssh web

sudo tail -f /var/log/nginx/access.log

  

# –õ–æ–≥–∏ Apache

sudo tail -f /var/log/apache2/access*.log

  

# –õ–æ–≥–∏ Prometheus

vagrant ssh monitoring

sudo journalctl -u prometheus -f

  

# –õ–æ–≥–∏ Grafana

sudo journalctl -u grafana-server -f

```

  

### –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏

  

```bash

vagrant ssh web

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ ab (Apache Bench)

ab -n 1000 -c 10 http://localhost/

  

# –ò–ª–∏ –ø—Ä–æ—Å—Ç–æ–π —Ü–∏–∫–ª

for i in {1..100}; do curl -s http://localhost > /dev/null; done

```

  

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–æ–≤

  

```bash

# –ù–∞ web-—Å–µ—Ä–≤–µ—Ä–µ

vagrant ssh web

sudo netstat -tlnp | grep -E ':(80|8081|8082|8083|9100|9113|9117)'

  

# –ù–∞ monitoring-—Å–µ—Ä–≤–µ—Ä–µ

vagrant ssh monitoring

sudo netstat -tlnp | grep -E ':(3000|5044|5601|9090|9200)'

```

  

---
  

## üìö –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

  

- [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Nginx upstream](https://nginx.org/ru/docs/http/ngx_http_upstream_module.html)

- [Prometheus exporters](https://prometheus.io/docs/instrumenting/exporters/)

- [ELK Stack Docker](https://www.elastic.co/guide/en/elastic-stack-get-started/current/get-started-docker.html)

- [Grafana Dashboards](https://grafana.com/grafana/dashboards/)

  

---

  

## –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
  

```bash

# –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –í–ú

vagrant up # –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö –í–ú

vagrant halt # –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö –í–ú

vagrant destroy -f # –£–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –í–ú

vagrant ssh web # SSH –≤ web-—Å–µ—Ä–≤–µ—Ä

vagrant ssh monitoring # SSH –≤ monitoring-—Å–µ—Ä–≤–µ—Ä

vagrant provision # –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ provisioning

vagrant reload --provision # –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ + provisioning

  

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤

curl http://192.168.56.10 # –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏

curl http://192.168.56.10:9100/metrics # Node exporter

curl http://192.168.56.20:9090/targets # Prometheus targets

```

  

---

  
